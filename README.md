# ğŸ“± Android AI Agent V2.0

åŸºäºæ— éšœç¢æœåŠ¡ (AccessibilityService) çš„è‡ªä¸»æ‰‹æœº AI Agentï¼Œé‡‡ç”¨é•¿æœŸä¸»ä¹‰æ¶æ„è®¾è®¡ã€‚

## ğŸ¯ V2.0 æ–°ç‰¹æ€§

### æ ¸å¿ƒèƒ½åŠ›
- âœ… **å¤šæ¨¡æ€è§†è§‰**ï¼šç»“åˆ UI æ ‘ + Vision APIï¼Œç†è§£å›¾ç‰‡ã€å›¾æ ‡ã€å¹¿å‘Š
- âœ… **æ™ºèƒ½è®°å¿†**ï¼šå­¦ä¹ å†å²æ“ä½œï¼Œè®°ä½æˆåŠŸè·¯å¾„ï¼Œä¼˜åŒ–å†³ç­–
- âœ… **ä»»åŠ¡è§„åˆ’**ï¼šå±‚æ¬¡ä»»åŠ¡åˆ†æ(HTA)ï¼Œå¤æ‚ä»»åŠ¡åˆ†è§£
- âœ… **é”™è¯¯æ¢å¤**ï¼šæ™ºèƒ½è¯†åˆ«å¹¶è‡ªåŠ¨å¤„ç† 6 ç±»å¸¸è§é”™è¯¯
- âœ… **PC åä½œ**ï¼šWebSocket åŒå‘é€šä¿¡ï¼ŒPC ä¸‹å‘ç›®æ ‡ã€å®æ—¶åŒæ­¥

### åŸºç¡€èƒ½åŠ›
- âœ… **æ— éœ€ Root**ï¼šåŸºäº AccessibilityService
- âœ… **AI é©±åŠ¨**ï¼šé›†æˆæ··å…ƒ APIï¼Œè‡ªä¸»å†³ç­–å’Œæ‰§è¡Œ
- âœ… **å®Œæ•´å·¥å…·ç³»ç»Ÿ**ï¼štapã€swipeã€inputã€press_key ç­‰
- âœ… **DDD æ¶æ„**ï¼šDomain â†’ Application â†’ Infrastructure â†’ Interface
- âœ… **å‰å°æœåŠ¡**ï¼šé˜²æ­¢è¢«ç³»ç»Ÿæ€æ­»

## ğŸ—ï¸ V2.0 æ¶æ„

```
domain/           # é¢†åŸŸå±‚ï¼ˆçº¯ä¸šåŠ¡é€»è¾‘ï¼‰
  â”œâ”€â”€ agent/      # Agent çŠ¶æ€ã€ç›®æ ‡ã€è®°å¿†
  â”œâ”€â”€ screen/     # UI èŠ‚ç‚¹æ¨¡å‹
  â”œâ”€â”€ tool/       # å·¥å…·æ¥å£å®šä¹‰
  â”œâ”€â”€ planning/   # ğŸ“¦ ä»»åŠ¡è§„åˆ’æ¥å£
  â””â”€â”€ recovery/   # ğŸ“¦ é”™è¯¯æ¢å¤ç­–ç•¥

application/      # åº”ç”¨å±‚ï¼ˆç”¨ä¾‹ç¼–æ’ï¼‰
  â”œâ”€â”€ AgentRuntime.kt           # Agent ä¸»å¾ªç¯ (V1)
  â”œâ”€â”€ EnhancedAgentRuntime.kt   # ğŸ“¦ å¢å¼ºè¿è¡Œæ—¶ (V2)
  â””â”€â”€ planning/                 # ğŸ“¦ AI ä»»åŠ¡è§„åˆ’å™¨

infrastructure/   # åŸºç¡€è®¾æ–½å±‚ï¼ˆæŠ€æœ¯å®ç°ï¼‰
  â”œâ”€â”€ accessibility/  # æ— éšœç¢æœåŠ¡å°è£…
  â”œâ”€â”€ ai/            # AI å®¢æˆ·ç«¯ (æ··å…ƒ)
  â”œâ”€â”€ tools/         # å…·ä½“å·¥å…·å®ç°
  â”œâ”€â”€ vision/        # ğŸ“¦ å¤šæ¨¡æ€è§†è§‰åˆ†æ
  â”œâ”€â”€ storage/       # ğŸ“¦ Room æ•°æ®åº“ + è®°å¿†ä»“åº“
  â”œâ”€â”€ network/       # ğŸ“¦ WebSocket + PC æ¡¥æ¥
  â””â”€â”€ recovery/      # ğŸ“¦ é€šç”¨æ¢å¤ç­–ç•¥

interface/        # æ¥å£å±‚
  â”œâ”€â”€ AgentService.kt    # æ— éšœç¢æœåŠ¡å…¥å£ (V1)
  â””â”€â”€ AgentServiceV2.kt  # ğŸ“¦ å¢å¼ºç‰ˆæœåŠ¡ (V2)
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æ„å»ºå®‰è£…

```bash
./gradlew assembleDebug
adb install -r app/build/outputs/apk/debug/app-debug.apk
```

### 2. é…ç½® API Keyï¼ˆApp å†…è®¾ç½®ï¼‰

æ‰“å¼€ Appï¼Œåœ¨é…ç½®ç•Œé¢å¡«å†™ï¼š

| é…ç½®é¡¹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|
| æ··å…ƒ API Key | âœ… | ç”¨äº AI å†³ç­–ï¼Œä»è…¾è®¯äº‘è·å– |
| è§†è§‰æœåŠ¡ | âŒ | é€‰æ‹©é€šä¹‰åƒé—® VL æˆ– GPT-4V |
| é€šä¹‰åƒé—® VL Key | âŒ | ç”¨äºå›¾ç‰‡ç†è§£ |
| OpenAI Key | âŒ | ç”¨äº GPT-4V è§†è§‰ |
| WebSocket ç«¯å£ | âŒ | PC è¿æ¥ç«¯å£ï¼Œé»˜è®¤ 11452 |

> ğŸ’¡ æ‰€æœ‰é…ç½®éƒ½åœ¨ App å†…å®Œæˆï¼Œæ— éœ€ä¿®æ”¹ä»£ç ï¼

### 3. å¯ç”¨æ— éšœç¢æœåŠ¡

```
è®¾ç½® â†’ è¾…åŠ©åŠŸèƒ½ â†’ æ— éšœç¢ â†’ Employee Agent V2 â†’ å¼€å¯
```

### 4. æµ‹è¯•

```bash
# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
adb logcat | grep Agent

# æŸ¥çœ‹ AI å†³ç­–
adb logcat | grep EnhancedAgentRuntime

# æŸ¥çœ‹é”™è¯¯æ¢å¤
adb logcat | grep Recovery
```

## ğŸŒ PC ç«¯åä½œ

### WebSocket è¿æ¥ï¼ˆæ¨èï¼‰

```typescript
// PC ç«¯ TypeScript
const ws = new WebSocket('ws://<phone_ip>:11452');

// å‘é€ç›®æ ‡
ws.send(JSON.stringify({
  type: 'goal',
  payload: {
    description: 'æ‰“å¼€å¾®ä¿¡å¹¶å‘é€æ¶ˆæ¯ç»™å¼ ä¸‰',
    maxSteps: 20
  }
}));

// æ¥æ”¶è¿›åº¦
ws.onmessage = (event) => {
  const msg = JSON.parse(event.data);
  if (msg.type === 'progress') {
    console.log(`æ­¥éª¤ ${msg.payload.step}: ${msg.payload.action}`);
  }
};
```

### åè®®æ¶ˆæ¯ç±»å‹

| ç±»å‹ | æ–¹å‘ | è¯´æ˜ |
|------|------|------|
| `goal` | PCâ†’æ‰‹æœº | è®¾ç½®æ‰§è¡Œç›®æ ‡ |
| `command` | PCâ†’æ‰‹æœº | æš‚åœ/ç»§ç»­/å–æ¶ˆ |
| `status` | æ‰‹æœºâ†’PC | çŠ¶æ€æ›´æ–° |
| `progress` | æ‰‹æœºâ†’PC | æ‰§è¡Œè¿›åº¦ |
| `screen` | æ‰‹æœºâ†’PC | å±å¹•å†…å®¹ |
| `thinking` | æ‰‹æœºâ†’PC | AI æ€è€ƒè¿‡ç¨‹ |
| `result` | æ‰‹æœºâ†’PC | æ‰§è¡Œç»“æœ |
| `error` | æ‰‹æœºâ†’PC | é”™è¯¯ä¿¡æ¯ |

## ğŸ› ï¸ å¯ç”¨å·¥å…·

| å·¥å…· | å‚æ•° | è¯´æ˜ |
|------|------|------|
| `tap` | `x: Int, y: Int` | ç‚¹å‡»åæ ‡ |
| `tap_element` | `text: String` | ç‚¹å‡»å…ƒç´ ï¼ˆé€šè¿‡æ–‡æœ¬ï¼‰ |
| `swipe` | `direction: String, distance: String` | æ»‘åŠ¨ |
| `press_key` | `key: String` | æŒ‰é”® (back/home/enter) |
| `wait` | `milliseconds: Long` | ç­‰å¾… |
| `get_screen` | - | è·å–å±å¹• UI |

## ğŸ§  æ™ºèƒ½è®°å¿†ç³»ç»Ÿ

V2.0 è‡ªåŠ¨å­¦ä¹ å¹¶è®°ä½ï¼š
- âœ… æ¯ä¸ªç›®æ ‡çš„æˆåŠŸæ‰§è¡Œè·¯å¾„
- âœ… App å†…å¸¸ç”¨æ“ä½œçš„å¿«æ·æ–¹å¼
- âœ… é”™è¯¯åœºæ™¯çš„å¤„ç†ç­–ç•¥
- âœ… ç”¨æˆ·åå¥½å’Œä¹ æƒ¯

```kotlin
// æ‰‹åŠ¨æŸ¥è¯¢å­¦ä¹ çš„æ¨¡å¼
val patterns = memoryRepository.getLearnedPatterns("click_wechat_contact")

// æŸ¥è¯¢ç›®æ ‡çš„å†å²æ‰§è¡Œ
val history = memoryRepository.getGoalActions("goal-uuid")
```

## ğŸ”§ é”™è¯¯æ¢å¤ç­–ç•¥

å†…ç½® 6 ç§è‡ªåŠ¨æ¢å¤ç­–ç•¥ï¼š

| ç­–ç•¥ | è§¦å‘æ¡ä»¶ | æ¢å¤åŠ¨ä½œ |
|------|----------|----------|
| `DialogDismiss` | æ£€æµ‹åˆ°å¯¹è¯æ¡† | è‡ªåŠ¨ç‚¹å‡»ç¡®å®š/å–æ¶ˆ |
| `PermissionRequest` | æƒé™è¯·æ±‚å¼¹çª— | è‡ªåŠ¨æˆäºˆæƒé™ |
| `ElementNotFound` | ç›®æ ‡å…ƒç´ ä¸å­˜åœ¨ | æ»šåŠ¨æŸ¥æ‰¾/ç­‰å¾…åŠ è½½ |
| `AppCrash` | åº”ç”¨å´©æºƒ | é‡å¯åº”ç”¨ |
| `ScreenChanged` | æ„å¤–é¡µé¢è·³è½¬ | è¿”å›ä¸Šä¸€é¡µ/é‡æ–°å¯¼èˆª |
| `NetworkError` | ç½‘ç»œé—®é¢˜ | ç­‰å¾…é‡è¯• |

## ğŸ“Š ä¸ä¸»æµ Agent å¯¹æ¯”

| ç‰¹æ€§ | æœ¬é¡¹ç›® | AppAgent | MobileAgent |
|------|--------|----------|-------------|
| åº•å±‚æŠ€æœ¯ | AccessibilityService | ADB + OCR | VLM + ADB |
| éœ€è¦ Root | âŒ | âŒ | âŒ |
| è§†è§‰ç†è§£ | âœ… Hybrid | âœ… GPT-4V | âœ… Qwen-VL |
| è®°å¿†å­¦ä¹  | âœ… | âŒ | âŒ |
| PC åä½œ | âœ… WebSocket | âŒ | âŒ |
| é”™è¯¯æ¢å¤ | âœ… è‡ªåŠ¨ | âŒ | éƒ¨åˆ† |

## âš ï¸ å·²çŸ¥é™åˆ¶

1. **API Key**ï¼šéœ€è¦é…ç½®æ··å…ƒ/é€šä¹‰åƒé—®/OpenAI API Key
2. **å‚å•†é™åˆ¶**ï¼šéƒ¨åˆ†å›½äº§ ROM ä¼šé™åˆ¶æ— éšœç¢æœåŠ¡
3. **Android ç‰ˆæœ¬**ï¼šminSdk 26 (Android 8.0+)
4. **æˆªå›¾æƒé™**ï¼šAndroid 11+ æ— éšœç¢æœåŠ¡å¯ç›´æ¥æˆªå›¾ï¼Œä½ç‰ˆæœ¬éœ€è¦ MediaProjection

## ğŸ“¦ ä¾èµ–

- Kotlin 1.8.22
- Kotlin Coroutines 1.7.3
- Room 2.6.1 (SQLite ORM)
- Gson 2.10.1
- OkHttp 4.12.0
- AndroidX Core/AppCompat
- Material Design

## ğŸ“„ License

MIT License
